% Copyright 2007 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/licenses/LICENSE for more details.

\ProvidesPackageRCS $Header: /Users/joseph/Documents/LaTeX/beamer/base/themes/outer/beamerouterthememiniframes.sty,v d02a7cf4d8ae 2010/06/17 09:11:41 rivanvx $

\setbeamercolor{section in head/foot}{parent=palette tertiary}
\setbeamercolor{subsection in head/foot}{parent=palette secondary}
\setbeamercolor{author in head/foot}{parent=subsection in head/foot}
\setbeamercolor{title in head/foot}{parent=section in head/foot}

\setbeamercolor{title in foot}{parent=title in head/foot,bg=white,fg=frametitle}
\setbeamercolor{author in foot}{parent=author in head/foot,fg=frametitle}
\setbeamercolor{institute in foot}{parent=institute in head/foot,fg=frametitle}

\def\beamer@theme@pagenumbers@none{
  \def\insertpagenumbers{}
}
\def\beamer@theme@pagenumbers@current{
  \def\insertpagenumbers{\hfill\insertframenumber}
}
\def\beamer@theme@pagenumbers@full{
  \def\insertpagenumbers{\hfill\insertframenumber\,/\,\inserttotalframenumber}
}

\def\beamer@theme@footline@empty{}
\def\beamer@theme@footline@fullsinglelight{
  \defbeamertemplate*{footline}{miniframes theme}
  {%
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{title in foot}%
      \leavevmode%
      {\usebeamerfont{title in head/foot}\insertshorttitle}%
      \hfill%
      {\usebeamerfont{author in head/foot}\usebeamercolor[fg]{author in foot}\insertshortauthor}%
      \hspace*{0.5em}%
      {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in foot}(\insertshortinstitute)}%
      \hfill%
      {\usebeamerfont{date in head/foot}\insertshortdate{}}%
      \insertpagenumbers%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[colsep=1.5pt]{lower separation line foot}
    \end{beamercolorbox}
  }
}
\def\beamer@theme@footline@fullsingledark{
  \defbeamertemplate*{footline}{miniframes theme}
  {%
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
      \leavevmode%
      {\usebeamerfont{title in head/foot}\insertshorttitle}%
      \hfill%
      {\usebeamerfont{author in head/foot}\usebeamercolor[fg]{author in head/foot}\insertshortauthor}%
      \hspace*{0.5em}%
      {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in head/foot}(\insertshortinstitute)}%
      \hfill%
      {\usebeamerfont{date in head/foot}\insertshortdate{}}%
      \insertpagenumbers%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[colsep=1.5pt]{lower separation line foot}
    \end{beamercolorbox}
  }
}
\def\beamer@theme@footline@authorinstitute{
  \defbeamertemplate*{footline}{miniframes theme}
  {%
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{author in head/foot}%
      \leavevmode{\usebeamerfont{author in head/foot}\insertshortauthor}%
      \hfill%
      {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in head/foot}\insertshortinstitute}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[colsep=1.5pt]{lower separation line foot}
    \end{beamercolorbox}
  }
}
\def\beamer@theme@footline@authortitle{
  \defbeamertemplate*{footline}{miniframes theme}
  {%
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
      \leavevmode{\usebeamerfont{title in head/foot}\insertshorttitle}%
      \hfill%
      {\usebeamerfont{author in head/foot}\usebeamercolor[fg]{author in head/foot}\insertshortauthor}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[colsep=1.5pt]{lower separation line foot}
    \end{beamercolorbox}
  }
}
\def\beamer@theme@footline@institutetitle{
  \defbeamertemplate*{footline}{miniframes theme}
  {%
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
      \leavevmode{\usebeamerfont{title in head/foot}\insertshorttitle}%
      \hfill%
      {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in head/foot}\insertshortinstitute}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[colsep=1.5pt]{lower separation line foot}
    \end{beamercolorbox}
  }
}
\def\beamer@theme@footline@authorinstitutetitle{
  \defbeamertemplate*{footline}{miniframes theme}
  {%
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{author in head/foot}%
      \leavevmode{\usebeamerfont{author in head/foot}\insertshortauthor}%
      \hfill%
      {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in head/foot}\insertshortinstitute}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
      {\usebeamerfont{title in head/foot}\insertshorttitle}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[colsep=1.5pt]{lower separation line foot}
    \end{beamercolorbox}
  }
}

\newif\ifbeamer@theme@subsection
\beamer@theme@subsectionfalse

\newif\ifbeamer@theme@hideminiframes
\beamer@theme@hideminiframesfalse

\DeclareOptionBeamer{pagenumbers}[full]{\csname beamer@theme@pagenumbers@#1\endcsname}
\DeclareOptionBeamer{footline}[fullsingledark]{\csname beamer@theme@footline@#1\endcsname}
\DeclareOptionBeamer{subsection}[false]{\csname beamer@theme@subsection#1\endcsname}
\DeclareOptionBeamer{hideminiframes}[false]{\beamer@theme@hideminiframestrue}
\ProcessOptionsBeamer

\mode<presentation>

% Head
\defbeamertemplate*{headline}{miniframes theme}
{%
  \begin{beamercolorbox}[colsep=1.5pt]{upper separation line head}
  \end{beamercolorbox}
  \ifbeamer@theme@hideminiframes\relax\else%
    \begin{beamercolorbox}{section in head/foot}
      \vskip2pt\insertnavigation{\paperwidth}\vskip2pt
    \end{beamercolorbox}%
  \fi
  \ifbeamer@theme@subsection%
    \begin{beamercolorbox}[colsep=1.5pt]{middle separation line head}
    \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{subsection in head/foot}
      \usebeamerfont{subsection in head/foot}\insertsubsectionhead
    \end{beamercolorbox}%
  \fi%
  \begin{beamercolorbox}[colsep=1.5pt]{lower separation line head}
  \end{beamercolorbox}
}

% % For convenience, move this to a style or theme file
% \makeatletter
% 
% \newcount\beamer@xoff
% \newcount\beamer@prev@section
% \newcount\beamer@prev@miniframes
% \beamer@xoff=0
% \beamer@prev@section=0
% \beamer@prev@miniframes=0
% 
% \def\insertsubsectionnavigationhorizontalminiframes#1#2#3{%
%   \hbox to #1{{%
%     \usebeamerfont{subsection in head/foot}\usebeamercolor[fg]{subsection in head/foot}%
%     \beamer@currentsubsection=0%
%     \def\sectionentry##1##2##3##4##5{}%
%     \def\slideentry##1##2##3##4##5##6{%
%       \ifnum##1>\beamer@prev@section%
%         \beamer@xoff=##3\relax%
%         \beamer@prev@miniframes=0\relax%
%       \fi
%       \ifnum##6=\c@part\ifnum##1=\c@section%
%       \ifnum##2>\beamer@currentsubsection%
%       \beamer@xoff=0\relax%
%       \beamer@currentsubsection=##2%
%       \box\beamer@sectionbox\hskip1.875ex plus1fill%
%       \ifnum\beamer@prev@miniframes>0\relax%
%         \beamer@tempdim=\beamer@boxsize%
%         \multiply\beamer@tempdim by \beamer@prev@miniframes%
%         \advance\beamer@tempdim by -\beamer@boxsize%
%         \advance\beamer@tempdim by 2pt%
%         \ifnum##2>1%
%           \advance\beamer@tempdim by 1.875ex%
%         \else
%           \advance\beamer@tempdim by -\beamer@boxsize%
%         \fi
%       \else
%         \beamer@tempdim=0pt%
%       \fi
%       \setbox\beamer@sectionbox=
%       \hbox{\def\insertsubsectionhead{\kern\beamer@tempdim##5}%
%          \def\insertsectionheadnumber{##1}%
%          \def\insertsubsectionheadnumber{##2}%
%          \def\insertpartheadnumber{##6}%
%          \ifnum\c@subsection=##2%
%         \beamer@link(##4){{\usebeamertemplate{subsection in head/foot}}}\else%
%         \beamer@link(##4){{\usebeamertemplate{subsection in head/foot shaded}}}\fi}%
%       \ht\beamer@sectionbox=1.875ex%
%       \dp\beamer@sectionbox=0.75ex%
%       \else%
%       \beamer@prev@miniframes=##3%
%       \fi%
%       \setbox0=\hbox{\insertsectionhead\unskip}\ifdim\wd0>0pt\ifnum##3>0%
%       \beamer@xpos=##3\relax%
%       \advance\beamer@xpos by -\beamer@xoff%
%       \hbox to 0pt{%
%         \beamer@tempdim=0.5pt%
%         \raise\beamer@tempdim\hbox{%
%           \ifnum##2>0%
%             \beamer@tempdim=\beamer@boxsize%
%             \multiply\beamer@tempdim by\beamer@xpos%
%             \advance\beamer@tempdim by -\beamer@boxsize%
%             \advance\beamer@tempdim by 2pt%
%             \advance\beamer@tempdim by \wd\beamer@sectionbox%
%           \else%
%             \beamer@tempdim=\beamer@boxsize%
%             \multiply\beamer@tempdim by\beamer@xpos%
%             \advance\beamer@tempdim by 1.875ex%
%           \fi%
%           \kern\beamer@tempdim\hbox{\beamer@link(##4){%
%               \usebeamerfont{mini frame}%
%               \ifnum\c@section=##1%
%                 \ifnum\c@subsection=##2%
%                   \usebeamercolor[fg]{mini frame}%
%                   \ifnum\c@subsectionslide=##3%
%                     \usebeamertemplate{mini frame}%
%                   \else%
%                     \usebeamertemplate{mini frame in current subsection}%
%                   \fi%
%                 \else%
%                   \usebeamercolor{mini frame}%
%                   \usebeamertemplate{mini frame in other subsection}%
%                 \fi%
%               \else%
%                 \usebeamercolor{mini frame}%
%                 \usebeamertemplate{mini frame in other subsection}%
%               \fi%
%             }}}\hskip-10cm plus 1fil%
%           }\fi\fi%
%       \else%
%       \fakeslideentry{##1}{##2}{##3}{##4}{##5}{##6}%
%       \fi\fi%
%       \beamer@prev@section=##1%
%       \ignorespaces}%
%     #2\hskip.3cm\setbox\beamer@sectionbox=\hbox{}%
%     \hskip-1.875ex plus-1fill\dohead%
%     \box\beamer@sectionbox\hfil\hskip.3cm%
%     #3}}}
% 
% \setbeamercolor{mini frame}{parent=subsection in head/foot}
% 
% \ifbeamer@compress
% 
% \defbeamertemplate*{headline}{split theme miniframes}
% {%
%   \leavevmode%
%   \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.5ex,dp=1.125ex]{section in head/foot}%
%     \insertsectionnavigationhorizontal{.5\paperwidth}{\hskip0pt plus1filll}{}%
%   \end{beamercolorbox}%
%   \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.5ex,dp=1.125ex]{section in head/foot}%
%     \insertsubsectionnavigationhorizontalminiframes{.5\paperwidth}{}{\hskip0pt plus1filll}%
%   \end{beamercolorbox}%
% }
% 
% \else
% 
% \defbeamertemplatealias{headline}{split theme miniframes}{split theme}
% \setbeamertemplate{headline}[split theme miniframes]
% 
% \fi
% 
% \makeatother
% 
% % This is to enable the feature
% \setbeamertemplate{headline}[split theme miniframes]

% \RequirePackage{remreset}
% \makeatletter
%   \@removefromreset{subsection}{section}
% \makeatother
% \setcounter{subsection}{1}

\RequirePackage{etoolbox}
\makeatletter
  \patchcmd{\slideentry}{\advance\beamer@tempdim by -.05cm}{\advance\beamer@tempdim by\beamer@vboxoffset\advance\beamer@tempdim by\beamer@boxsize\advance\beamer@tempdim by 1.2\pgflinewidth}{}{}
  \patchcmd{\slideentry}{\kern\beamer@tempdim}{\advance\beamer@tempdim by 2pt\advance\beamer@tempdim by\wd\beamer@sectionbox\kern\beamer@tempdim}{}{}
  \patchcmd{\slideentry}{\ifnum#2>0}{\ifnum2>0}{}{}
%   \patchcmd{\fakeslideentry}{\ifnum#2>0}{\ifnum2>0}{}{}
%   \patchcmd{\slideentry}{\beamer@ypos=#2}{\beamer@ypos=1}{}{}
%   \patchcmd{\slideentry}{\advance\beamer@xpos by1\relax}{}{}{}
%   \def\beamer@subsectionentry#1#2#3#4#5{\advance\beamer@xpos by1\relax}%
\makeatother

\mode
<all>
